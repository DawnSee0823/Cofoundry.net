angular.module("cms.directories",["ngRoute","cms.shared"]).constant("_",window._).constant("directories.modulePath","/Admin/Modules/Directories/Js/"),angular.module("cms.directories").config(["$routeProvider","shared.routingUtilities","directories.modulePath",function(e,t,r){t.registerCrudRoutes(e,r,"Directory")}]),angular.module("cms.directories").factory("directories.directoryService",["$http","_","shared.serviceBase","directories.DirectoryTree",function(t,e,r,o){var n={},i=r+"page-directories";function a(e){return i+"/"+e}return n.getAll=function(){return t.get(i)},n.getTree=function(){return t.get(i+"/tree").then(function(e){return e&&new o(e)})},n.getById=function(e){return t.get(a(e))},n.add=function(e){return t.post(i,e)},n.update=function(e){return t.patch(a(e.pageDirectoryId),e)},n.remove=function(e){return t.delete(a(e))},n}]),angular.module("cms.directories").factory("directories.DirectoryTree",["_",function(n){return function(e){var t=this;n.extend(t,e),t.flatten=function(o){var e=[];return function t(e,r){if(e.pageDirectoryId==o)return;r.push(e);n.each(e.childPageDirectories,function(e){t(e,r)})}(t,e),e},t.findNodeById=function(o){return function t(e){var r;if(!e)return;e.forEach(function(e){r=r||(e.pageDirectoryId==o?e:t(e.childPageDirectories))});return r}([t])}}}]),angular.module("cms.directories").directive("cmsDirectoryGrid",["shared.permissionValidationService","directories.modulePath",function(e,t){return{restrict:"E",templateUrl:t+"UIComponents/DirectoryGrid.html",scope:{pageDirectories:"=cmsDirectories",startDepth:"=cmsStartDepth",redirect:"=cmsRedirect"},replace:!1,controller:function(){var o=this;o.getPathDepthIndicator=function(e){for(var t="",r=(o.startDepth||0)+1;r<e;r++)t+="â€” ";return t},o.canUpdate=e.canUpdate("COFDIR")},controllerAs:"vm",bindToController:!0}}]),angular.module("cms.directories").controller("AddDirectoryController",["$location","shared.stringUtilities","shared.LoadState","directories.directoryService",function(e,t,r,o){var n=this;function i(){n.globalLoadState.on(),o.add(n.command).then(s,n.globalLoadState.off)}function a(){n.formLoadState.off()}function c(){n.command.urlPath=t.slugify(n.command.name)}function d(){s()}function s(){e.path("/")}n.command={},n.formLoadState=new r(!0),n.globalLoadState=new r,n.editMode=!1,n.save=i,n.cancel=d,n.onNameChanged=c,n.onDirectoriesLoaded=a}]),angular.module("cms.directories").controller("DirectoryDetailsController",["$routeParams","$q","$location","_","shared.stringUtilities","shared.LoadState","shared.modalDialogService","shared.permissionValidationService","directories.directoryService","directories.modulePath",function(e,t,r,o,n,i,a,c,d,s){var u=this;function l(){u.editMode=!0,u.mainForm.formStatus.clear()}function f(){v(u.saveLoadState),d.update(u.command).then(function(e){return D().then(u.mainForm.formStatus.success.bind(null,e))}.bind(null,"Changes were saved successfully")).finally(S.bind(null,u.saveLoadState))}function m(){u.editMode=!1,u.command=p(u.pageDirectory),u.mainForm.formStatus.clear()}function h(){var e={title:"Delete Directory",message:"Deleting this directory will delete ALL sub-directories and pages linked to this directory. Are you sure you want to continue?",okButtonTitle:"Yes, delete it",onOk:function(){return v(),d.remove(u.pageDirectory.pageDirectoryId).then(y).catch(S)}};a.confirm(e)}function g(){u.hasChildContent||(u.command.urlPath=n.slugify(u.command.name))}function D(){var r=e.id;return d.getTree().then(function(e){var t=e.findNodeById(r),e=e.flatten(r);u.pageDirectory=t,u.parentDirectories=e,u.command=p(t),u.editMode=!1,u.hasChildContent=t.numPages||t.childPageDirectories.length})}function p(e){return o.pick(e,"pageDirectoryId","name","urlPath","parentPageDirectoryId")}function y(){r.path("")}function v(e){u.globalLoadState.on(),e&&o.isFunction(e.on)&&e.on()}function S(e){u.globalLoadState.off(),e&&o.isFunction(e.off)&&e.off()}u.edit=l,u.save=f,u.cancel=m,u.deleteDirectory=h,u.onNameChanged=g,u.editMode=!1,u.globalLoadState=new i,u.saveLoadState=new i,u.formLoadState=new i(!0),u.canUpdate=c.canUpdate("COFDIR"),u.canDelete=c.canDelete("COFDIR"),D().then(S.bind(null,u.formLoadState))}]),angular.module("cms.directories").controller("DirectoryListController",["_","shared.modalDialogService","shared.LoadState","shared.SearchQuery","shared.permissionValidationService","directories.directoryService",function(e,t,r,o,n,i){var a=this;a.gridLoadState=new r,a.canCreate=n.canCreate("COFDIR"),a.gridLoadState.on(),i.getTree().then(function(e){e=e.flatten();a.result=e.slice(1,e.length),a.gridLoadState.off()})}]);