angular.module("cms.users",["ngRoute","cms.shared"]).constant("_",window._).constant("users.modulePath","/Admin/Modules/Users/Js/"),angular.module("cms.users").config(["$routeProvider","shared.routingUtilities","users.modulePath",function(e,t,r){t.registerCrudRoutes(e,r,"User")}]),angular.module("cms.users").factory("users.roleService",["$http","shared.serviceBase","users.options",function(e,t,r){var n={},o=t+"roles";return n.getSelectionList=function(){return e.get(o,{params:{userAreaCode:r.userAreaCode,excludeAnonymous:!0}})},n}]),angular.module("cms.users").factory("users.userService",["$http","shared.serviceBase","users.options",function(t,e,r){var n={},o=e+"users";function a(e){return o+"/"+e}function s(e){return(e=e||{}).userAreaCode=r.userAreaCode,e}return n.getAll=function(e){return e=s(e),t.get(o,{params:e})},n.getById=function(e){return t.get(a(e))},n.add=function(e){return(e=s(e)).generatePassword=!0,t.post(o,e)},n.update=function(e){return t.patch(a(e.userId),e)},n.remove=function(e){return t.delete(a(e))},n}]),angular.module("cms.users").controller("AddUserController",["$location","_","shared.stringUtilities","shared.LoadState","users.userService","users.roleService","users.options",function(e,t,r,n,o,a,s){var u=this;function i(){u.globalLoadState.on(),o.add(u.command).then(d).finally(u.globalLoadState.off)}function l(){d()}function d(){e.path("/")}a.getSelectionList().then(function(e){e&&(u.roles=e.items,1===e.items.length&&(u.command.roleId=e.items[0].roleId))}),u.command={},u.globalLoadState=new n,u.editMode=!1,u.userArea=s,u.save=i,u.cancel=l}]),angular.module("cms.users").controller("UserDetailsController",["$routeParams","$location","$q","shared.LoadState","shared.modalDialogService","shared.permissionValidationService","users.userService","users.roleService","users.modulePath","users.options",function(t,e,r,n,o,a,s,u,i,l){var d=this;function c(){d.editMode=!0,d.mainForm.formStatus.clear()}function f(){p(d.saveLoadState),s.update(d.command).then(function(e){return h().then(S).then(d.mainForm.formStatus.success.bind(null,e))}.bind(null,"Changes were saved successfully")).finally(C.bind(null,d.saveLoadState))}function m(){d.editMode=!1,d.command=v(),d.mainForm.formStatus.clear()}function g(){var e={title:"Delete User",message:"Are you sure you want to delete this user?",okButtonTitle:"Yes, delete it",onOk:function(){return p(),s.remove(d.user.userId).then(L).catch(C)}};o.confirm(e)}function h(){var e=t.id;return s.getById(e).then(function(e){d.user=e})}function S(){d.command=v(),d.editMode=!1}function v(){var e=_.pick(d.user,"userId","firstName","lastName","username","email");return d.user.role&&(e.roleId=d.user.role.roleId),e}function L(){e.path("")}function p(e){d.globalLoadState.on(),e&&_.isFunction(e.on)&&e.on()}function C(e){d.globalLoadState.off(),e&&_.isFunction(e.off)&&e.off()}!function(){d.edit=c,d.save=f,d.cancel=m,d.deleteUser=g,d.editMode=!1,d.globalLoadState=new n,d.saveLoadState=new n,d.formLoadState=new n(!0);var e="COF"===(d.userArea=l).userAreaCode?"COFUSR":"COFUSN";d.canUpdate=a.canUpdate(e),d.canDelete=a.canDelete(e),r.all([u.getSelectionList().then(function(e){e&&(d.roles=e.items)}),h()]).then(S).then(C.bind(null,d.formLoadState))}()}]),angular.module("cms.users").controller("UserListController",["_","shared.LoadState","shared.SearchQuery","shared.urlLibrary","shared.permissionValidationService","users.userService","users.options",function(t,r,n,o,a,e,s){var u=this;function i(e){u.isFilterVisible=t.isUndefined(e)?!u.isFilterVisible:e}function l(){i(!1),d()}function d(){return u.gridLoadState.on(),e.getAll(u.query.getParameters()).then(function(e){u.result=e,u.gridLoadState.off()})}!function(){u.userArea=s,u.urlLibrary=o,u.gridLoadState=new r,u.query=new n({onChanged:l}),u.filter=u.query.getFilters(),u.toggleFilter=i;var e="COF"===s.userAreaCode?"COFUSR":"COFUSN";u.canRead=a.canRead(e),u.canUpdate=a.canUpdate(e),u.canCreate=a.canCreate(e),i(!1),d()}()}]);