angular.module("cms.users",["ngRoute","cms.shared"]).constant("_",window._).constant("users.modulePath","/Admin/Modules/Users/Js/");
angular.module("cms.users").config(["$routeProvider","shared.routingUtilities","users.modulePath",function(e,r,s){r.registerCrudRoutes(e,s,"User")}]);
angular.module("cms.users").factory("users.userService",["$http","shared.serviceBase","users.options",function(r,e,t){var n={},u=e+"users";function s(e){return u+"/"+e}function o(e){return(e=e||{}).userAreaCode=t.userAreaCode,e}return n.getAll=function(e){return e=o(e),r.get(u,{params:e})},n.getById=function(e){return r.get(s(e))},n.add=function(e){return(e=o(e)).generatePassword=!0,r.post(u,e)},n.update=function(e){return r.patch(s(e.userId),e)},n.remove=function(e){return r.delete(s(e))},n}]);
angular.module("cms.users").controller("AddUserController",["$location","_","shared.stringUtilities","shared.LoadState","shared.roleService","users.userService","users.options",function(e,o,t,a,n,r,s){var l=this;function i(){l.globalLoadState.on(),r.add(l.command).then(c).finally(l.globalLoadState.off)}function d(){c()}function c(){e.path("/")}n.getSelectionList(s.userAreaCode).then(function(e){e&&(l.roles=e.items,1===e.items.length&&(l.command.roleId=e.items[0].roleId))}),l.command={},l.globalLoadState=new a,l.editMode=!1,l.userArea=s,l.save=i,l.cancel=d}]);
angular.module("cms.users").controller("UserDetailsController",["$routeParams","$location","$q","shared.LoadState","shared.modalDialogService","shared.permissionValidationService","shared.roleService","users.userService","users.modulePath","users.options",function(t,e,n,a,o,r,s,u,i,l){var d=this;function c(){d.editMode=!0,d.mainForm.formStatus.clear()}function m(){C(d.saveLoadState),u.update(d.command).then(function(e){return S().then(v).then(d.mainForm.formStatus.success.bind(null,e))}.bind(null,"Changes were saved successfully")).finally(F.bind(null,d.saveLoadState))}function f(){d.editMode=!1,d.command=g(),d.mainForm.formStatus.clear()}function h(){var e={title:"Delete User",message:"Are you sure you want to delete this user?",okButtonTitle:"Yes, delete it",onOk:function(){return C(),u.remove(d.user.userId).then(L).catch(F)}};o.confirm(e)}function S(){var e=t.id;return u.getById(e).then(function(e){d.user=e})}function v(){d.command=g(),d.editMode=!1}function g(){var e=_.pick(d.user,"userId","firstName","lastName","email","requirePasswordChange","isEmailConfirmed");return d.user.role&&(e.roleId=d.user.role.roleId),e.username=d.userArea.useEmailAsUsername?null:d.user.username,e}function L(){e.path("")}function C(e){d.globalLoadState.on(),e&&_.isFunction(e.on)&&e.on()}function F(e){d.globalLoadState.off(),e&&_.isFunction(e.off)&&e.off()}!function(){d.edit=c,d.save=m,d.cancel=f,d.deleteUser=h,d.editMode=!1,d.globalLoadState=new a,d.saveLoadState=new a,d.formLoadState=new a(!0);var e="COF"===(d.userArea=l).userAreaCode?"COFUSR":"COFUSN";d.canUpdate=r.canUpdate(e),d.canDelete=r.canDelete(e),n.all([s.getSelectionList(l.userAreaCode).then(function(e){e&&(d.roles=e.items)}),S()]).then(v).then(F.bind(null,d.formLoadState))}()}]);
angular.module("cms.users").controller("UserListController",["_","shared.LoadState","shared.SearchQuery","shared.urlLibrary","shared.permissionValidationService","users.userService","users.options",function(r,a,t,i,n,e,s){var o=this;function u(e){o.isFilterVisible=r.isUndefined(e)?!o.isFilterVisible:e}function d(){u(!1),l()}function l(){return o.gridLoadState.on(),e.getAll(o.query.getParameters()).then(function(e){o.result=e,o.gridLoadState.off()})}!function(){o.userArea=s,o.urlLibrary=i,o.gridLoadState=new a,o.query=new t({onChanged:d}),o.filter=o.query.getFilters(),o.toggleFilter=u;var e="COF"===s.userAreaCode?"COFUSR":"COFUSN";o.canRead=n.canRead(e),o.canUpdate=n.canUpdate(e),o.canCreate=n.canCreate(e),u(!1),l()}()}]);