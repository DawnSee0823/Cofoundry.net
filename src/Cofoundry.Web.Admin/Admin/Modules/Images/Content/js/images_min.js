/*! UberCMS 2017-07-13 */
angular.module("cms.images",["ngRoute","cms.shared"]).constant("_",window._).constant("images.modulePath","/Admin/Modules/Images/Js/"),angular.module("cms.images").config(["$routeProvider","shared.routingUtilities","images.modulePath",function(a,b,c){b.registerCrudRoutes(a,c,"Image")}]),angular.module("cms.images").factory("images.imageService",["$http","$upload","shared.imageService",function(a,b,c){var d=_.extend({},c);return d.remove=function(b){return a["delete"](d.getIdRoute(b))},d}]),angular.module("cms.images").controller("AddImageController",["$location","_","shared.focusService","shared.stringUtilities","shared.LoadState","images.imageService",function(a,b,c,d,e,f){function g(){j(),m.save=h,m.cancel=k,m.onFileChanged=i,m.editMode=!1,m.saveLoadState=new e}function h(){m.saveLoadState.on(),f.add(m.command).progress(m.saveLoadState.setProgress).then(l)}function i(){var a=m.command;a.file&&a.file.name&&(a.title=d.capitaliseFirstLetter(d.getFileNameWithoutExtension(a.file.name)),c.focusById("title"))}function j(){m.command={}}function k(){l()}function l(){a.path("")}var m=this;g()}]),angular.module("cms.images").controller("ImageDetailsController",["$routeParams","$q","$location","_","shared.LoadState","shared.modalDialogService","shared.permissionValidationService","images.imageService","images.modulePath",function(a,b,c,d,e,f,g,h,i){function j(){u.edit=k,u.save=l,u.cancel=m,u.remove=n,u.editMode=!1,u.globalLoadState=new e,u.saveLoadState=new e,u.formLoadState=new e(!0),u.canDelete=g.canDelete("COFIMG"),u.canUpdate=g.canUpdate("COFIMG"),p(u.formLoadState)}function k(){u.editMode=!0,u.mainForm.formStatus.clear()}function l(){s(u.saveLoadState),h.update(u.command).then(o.bind(null,"Changes were saved successfully",u.saveLoadState))}function m(){u.editMode=!1,u.previewImage=d.clone(u.image),u.command=q(u.image),u.mainForm.formStatus.clear()}function n(){function a(){return s(),h.remove(u.image.imageAssetId).then(r)["catch"](t)}var b={title:"Delete Image",message:"Are you sure you want to delete this image?",okButtonTitle:"Yes, delete it",onOk:a};f.confirm(b)}function o(a,b){return p(b).then(u.mainForm.formStatus.success.bind(null,a))}function p(b){function c(){return h.getById(a.id).then(function(a){u.image=a,u.previewImage=a,u.command=q(a),u.editMode=!1})}return c().then(t.bind(null,b))}function q(a){return d.pick(a,"imageAssetId","title","tags","defaultAnchorLocation")}function r(){c.path("")}function s(a){u.globalLoadState.on(),a&&d.isFunction(a.on)&&a.on()}function t(a){u.globalLoadState.off(),a&&d.isFunction(a.off)&&a.off()}var u=this;j()}]),angular.module("cms.images").controller("ImageListController",["_","shared.LoadState","shared.SearchQuery","shared.permissionValidationService","images.imageService",function(a,b,c,d,e){function f(){j.gridLoadState=new b,j.query=new c({onChanged:h}),j.filter=j.query.getFilters(),j.toggleFilter=g,j.canCreate=d.canCreate("COFIMG"),j.canUpdate=d.canUpdate("COFIMG"),g(!1),i()}function g(b){j.isFilterVisible=a.isUndefined(b)?!j.isFilterVisible:b}function h(){g(!1),i()}function i(){return j.gridLoadState.on(),e.getAll(j.query.getParameters()).then(function(a){j.result=a,j.gridLoadState.off()})}var j=this;f()}]);