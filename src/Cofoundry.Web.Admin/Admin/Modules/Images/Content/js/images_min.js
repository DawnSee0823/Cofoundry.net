angular.module("cms.images",["ngRoute","cms.shared"]).constant("_",window._).constant("images.modulePath","/Admin/Modules/Images/Js/"),angular.module("cms.images").config(["$routeProvider","shared.routingUtilities","images.modulePath",function(e,t,a){t.registerCrudRoutes(e,a,"Image")}]),angular.module("cms.images").factory("images.imageService",["$http","shared.imageService",function(t,e){var a=_.extend({},e);return a.remove=function(e){return t.delete(a.getIdRoute(e))},a}]),angular.module("cms.images").controller("AddImageController",["$location","$scope","_","shared.focusService","shared.stringUtilities","shared.LoadState","images.imageService",function(e,t,a,n,i,o,r){var s=this;function d(){s.saveLoadState.on(),r.add(s.command).progress(s.saveLoadState.setProgress).then(l)}function m(){var e=s.command;e.file&&e.file.name&&(e.title=i.capitaliseFirstLetter(i.getFileNameWithoutExtension(e.file.name)),n.focusById("title"))}function c(){l()}function l(){e.path("")}s.command={},s.save=d,s.cancel=c,t.$watch("vm.command.file",m),s.editMode=!1,s.saveLoadState=new o}]),angular.module("cms.images").controller("ImageDetailsController",["$routeParams","$q","$location","_","shared.LoadState","shared.modalDialogService","shared.permissionValidationService","shared.urlLibrary","images.imageService","images.modulePath",function(t,e,a,n,i,o,r,s,d,m){var c=this;function l(){c.editMode=!0,c.mainForm.formStatus.clear()}function u(){L(c.saveLoadState),d.update(c.command).progress(c.saveLoadState.setProgress).then(function(e,t){return h(t).then(c.mainForm.formStatus.success.bind(null,e))}.bind(null,"Changes were saved successfully",c.saveLoadState))}function g(){c.editMode=!1,c.previewImage=n.clone(c.image),c.command=v(c.image),c.previewUrl=s.getImageUrl(c.previewImage),c.mainForm.formStatus.clear()}function f(){var e={title:"Delete Image",message:"Are you sure you want to delete this image?",okButtonTitle:"Yes, delete it",onOk:function(){return L(),d.remove(c.image.imageAssetId).then(S).catch(p)}};o.confirm(e)}function h(e){return d.getById(t.id).then(function(e){c.image=e,c.previewImage=e,c.command=v(e),c.previewUrl=s.getImageUrl(c.previewImage),c.editMode=!1}).then(p.bind(null,e))}function v(e){return n.pick(e,"imageAssetId","title","tags","defaultAnchorLocation")}function S(){a.path("")}function L(e){c.globalLoadState.on(),e&&n.isFunction(e.on)&&e.on()}function p(e){c.globalLoadState.off(),e&&n.isFunction(e.off)&&e.off()}c.edit=l,c.save=u,c.cancel=g,c.remove=f,c.editMode=!1,c.globalLoadState=new i,c.saveLoadState=new i,c.formLoadState=new i(!0),c.canDelete=r.canDelete("COFIMG"),c.canUpdate=r.canUpdate("COFIMG"),h(c.formLoadState)}]),angular.module("cms.images").controller("ImageListController",["_","shared.LoadState","shared.SearchQuery","shared.permissionValidationService","images.imageService",function(t,e,a,n,i){var o=this;function r(e){o.isFilterVisible=t.isUndefined(e)?!o.isFilterVisible:e}function s(){r(!1),d()}function d(){return o.gridLoadState.on(),i.getAll(o.query.getParameters()).then(function(e){o.result=e,o.gridLoadState.off()})}o.gridLoadState=new e,o.query=new a({onChanged:s}),o.filter=o.query.getFilters(),o.toggleFilter=r,o.canCreate=n.canCreate("COFIMG"),o.canUpdate=n.canUpdate("COFIMG"),r(!1),d()}]);