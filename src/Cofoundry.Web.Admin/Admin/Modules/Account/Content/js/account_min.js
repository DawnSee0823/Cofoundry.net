angular.module("cms.account", ["ngRoute", "cms.shared"]).constant("_", window._).constant("account.modulePath", "/admin/modules/account/js/"); angular.module("cms.account").config(["$routeProvider", "shared.routingUtilities", "account.modulePath", function (n, t, i) { n.when("/change-password", t.mapOptions(i, "ChangePassword")).otherwise(t.mapOptions(i, "AccountDetails")) }]); angular.module("cms.account").controller("AccountDetailsController", ["shared.LoadState", "shared.modalDialogService", "account.accountService", "account.modulePath", function (n, t, i) { function s() { r.edit = h; r.save = c; r.cancel = l; r.editMode = !1; r.globalLoadState = new n; r.saveLoadState = new n; r.formLoadState = new n(!0); f().then(u.bind(null, r.formLoadState)) } function h() { r.editMode = !0; r.mainForm.formStatus.clear() } function c() { o(r.saveLoadState); i.update(r.command).then(a.bind(null, "Changes were saved successfully")).finally(u.bind(null, r.saveLoadState)) } function l() { r.editMode = !1; r.command = e(r.user); r.mainForm.formStatus.clear() } function a(n) { return f().then(r.mainForm.formStatus.success.bind(null, n)) } function f() { function n(n) { r.user = n; r.command = e(n); r.editMode = !1 } return i.getAccountDetails().then(n) } function e(n) { return _.pick(n, "firstName", "lastName", "email") } function o(n) { r.globalLoadState.on(); n && _.isFunction(n.on) && n.on() } function u(n) { r.globalLoadState.off(); n && _.isFunction(n.off) && n.off() } var r = this; s() }]); angular.module("cms.account").controller("ChangePasswordController", ["$location", "shared.LoadState", "shared.modalDialogService", "account.accountService", function (n, t, i, r) { function e() { u.save = o; u.cancel = s; u.doesPasswordMatch = h; u.globalLoadState = new t; u.formLoadState = new t(!0); c().then(u.formLoadState.off) } function o() { u.globalLoadState.on(); r.updatePassword(u.command).then(f).finally(u.globalLoadState.off) } function s() { f() } function h(n) { return u.command ? u.command.newPassword === n : !1 } function c() { function n(n) { u.user = n; u.command = {} } return r.getAccountDetails().then(n) } function f() { n.path("/") } var u = this; e() }]); angular.module("cms.account").factory("account.accountService", ["$http", "shared.serviceBase", function (n, t) { var i = {}, r = t + "account"; return i.getAccountDetails = function () { return n.get(r) }, i.update = function (t) { return n.patch(r, t) }, i.updatePassword = function (t) { return n.put(r + "/password", t) }, i }])