<cms-page-header cms-title="{{vm.page.pageRoute.fullPath}}"
                 cms-parent-title="Pages"></cms-page-header>

<cms-form cms-name="mainForm"
          cms-edit-mode="vm.editMode"
          ng-submit="vm.save()"
          cms-loading="vm.formLoadState.isLoading">

    <cms-page-sub-header>
        Last saved {{vm.page.auditData.createDate}}
    </cms-page-sub-header>
    <!-- Default toolbar -->
    <cms-page-actions ng-show="!vm.editMode">
        <cms-button cms-text="Edit"
                    ng-click="vm.edit()"
                    ng-show="!vm.editMode"
                    ng-disabled="vm.globalLoadState.isLoading" class="main-cta"></cms-button>

        <cms-button-link cms-text="Browse to page"
                         cms-icon="eye-open"
                         cms-href="{{vm.page.pageRoute.fullPath}}"></cms-button-link>

        <cms-button cms-text="Publish"
                    ng-click="vm.publish()"
                    ng-disabled="vm.editMode || vm.globalLoadState.isLoading"
                    ng-if="!vm.page.pageRoute.isPublished"></cms-button>

        <cms-button cms-text="Unpublish"
                    ng-click="vm.unpublish()"
                    ng-disabled="vm.editMode || vm.globalLoadState.isLoading"
                    ng-if="vm.page.pageRoute.isPublished"></cms-button>

        <cms-button cms-text="Change Url"
                    ng-click="vm.changeUrl()"
                    ng-disabled="vm.editMode || vm.globalLoadState.isLoading"></cms-button>

        <cms-button cms-text="Duplicate"
                    ng-click="vm.duplicatePage()"
                    ng-disabled="vm.editMode || vm.globalLoadState.isLoading"></cms-button>

        <cms-button cms-text="Delete"
                    ng-click="vm.deletePage()"
                    ng-disabled="vm.editMode || vm.globalLoadState.isLoading"></cms-button>
    </cms-page-actions>

    <!-- Edit mode toolbar -->
    <cms-page-actions ng-show="vm.editMode">

        <cms-button-submit cms-text="Save Draft"
                           cms-loading="vm.saveLoadState.isLoading"
                           ng-show="vm.editMode"
                           ng-disabled="vm.mainForm.$invalid || vm.globalLoadState.isLoading"></cms-button-submit>

        <cms-button cms-text="Save &amp; Publish"
                    cms-loading="vm.saveAndPublishLoadState.isLoading"
                    ng-disabled="vm.mainForm.$invalid || vm.globalLoadState.isLoading"
                    ng-click="vm.saveAndPublish()"></cms-button>

        <cms-button cms-text="Cancel"
                    ng-click="vm.cancel()"
                    ng-show="vm.editMode"
                    ng-disabled="vm.globalLoadState.isLoading"></cms-button>

    </cms-page-actions>

    <!-- Scrollable content area -->
    <cms-page-body cms-sub-header="with-header" 
                   cms-content-type="form">

        <!-- UI feedback -->
        <cms-form-status></cms-form-status>

        <!-- Main -->
        <cms-form-section cms-title="Main">

            <cms-form-field-text cms-title="Title"
                                 cms-model="vm.updateDraftCommand.title"
                                 cms-description="A few words descriptive page title, e.g. 'About the team'. Google SERP shows a maximum of 66 characters"
                                 required
                                 maxlength="70"></cms-form-field-text>

            <cms-form-field-readonly cms-title="Market"
                                     cms-model="vm.page.pageRoute.locale.ietfLanguageTag"></cms-form-field-readonly>

            <cms-form-field-container cms-title="Url">
                <a ng-href="{{vm.page.pageRoute.fullPath}}">{{vm.page.pageRoute.fullPath}}</a>
            </cms-form-field-container>

            <cms-form-field-checkbox cms-title="Is Published"
                                     cms-model="vm.page.pageRoute.isPublished"
                                     disabled></cms-form-field-checkbox>

            <cms-form-field-tags cms-title="CMS Tags"
                                 cms-model="vm.updatePageCommand.tags"></cms-form-field-tags>

        </cms-form-section>

        <!-- Meta data -->
        <cms-form-section cms-title="SEO">

            <cms-form-field-text-area cms-title="Meta Description"
                                      cms-model="vm.updateDraftCommand.metaDescription"
                                      cms-description="Ideally 25-250 characters. The Google SERP shows only the first 150 characters"
                                      required
                                      rows="3"
                                      maxlength="256"></cms-form-field-text-area>

            <cms-form-field-text cms-title="Meta Keywords"
                                 cms-model="vm.updateDraftCommand.metaKeywords"
                                 cms-description="Optional. A comma separated list of (ideally at least 3) keywords specific to this page e.g. 'dog,golden retriever,animal'. These will be combined with the site wide keywords."></cms-form-field-text>

            <cms-form-field-text cms-title="OpenGraph Title"
                                 cms-model="vm.updateDraftCommand.openGraphTitle"
                                 cms-description="Optional. Use this title to override what Facebook sees as the title of the page"></cms-form-field-text>

            <cms-form-field-text-area cms-title="OpenGraph Description"
                                      cms-model="vm.updateDraftCommand.openGraphDescription"
                                      cms-description="Optional. This description shows up in Facebook"
                                      rows="3"></cms-form-field-text-area>

            <cms-form-field-image-asset cms-title="OpenGraph Image"
                                        cms-load-state="vm.saveLoadState"
                                        cms-asset="vm.page.latestVersion.openGraph.image"
                                        cms-model="vm.updateDraftCommand.openGraphImageId"
                                        cms-val-min-width="200"
                                        cms-val-min-height="200"
                                        cms-update-asset="true"
                                        cms-description="Optional. An image to show up within Facebook. The image must be at least 200px by 200px (though minimum 1500px by 1500px is preferred) and have a maximum aspect ratio of 3:1."></cms-form-field-image-asset>

            <cms-form-field-checkbox cms-title="Show in sitemap"
                                     cms-model="vm.updateDraftCommand.showInSiteMap"
                                     cms-description="Indicates whether this page should be included in the site map file used by search engine robots"></cms-form-field-checkbox>

        </cms-form-section>

        <!-- Page versions -->
        <cms-form-section cms-title="Versions">
            <cms-form-field-container>
                <ng-include src="::vm.getPartialUrl('PageVersionList')"></ng-include>
            </cms-form-field-container>
        </cms-form-section>

        <!-- Audit data -->
        <cms-form-section-audit-data cms-audit-data="vm.page.auditData"></cms-form-section-audit-data>

    </cms-page-body>

</cms-form>